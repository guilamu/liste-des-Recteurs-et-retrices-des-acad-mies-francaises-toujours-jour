<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste des Recteurs et Rectrices</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
            color: #333;
            line-height: 1.6;
        }

        h1 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        /* Style pour le sous-titre de mise √† jour */
        #last-update {
            color: #666;
            font-style: italic;
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            /* Pour les coins arrondis */
        }

        th,
        td {
            border-bottom: 1px solid #eee;
            padding: 12px 15px;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #444;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:nth-child(even) {
            background-color: #fafafa;
        }

        tr:hover {
            background-color: #f1f8ff;
        }

        a {
            color: #0366d6;
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
        }

        .error-text {
            color: #d73a49;
            font-size: 0.9em;
            background-color: #ffeef0;
            border-radius: 4px;
            padding: 2px 6px;
        }

        /* Responsive pour mobile */
        @media (max-width: 600px) {

            table,
            thead,
            tbody,
            th,
            td,
            tr {
                display: block;
            }

            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            tr {
                margin-bottom: 1rem;
                border: 1px solid #eee;
                border-radius: 8px;
            }

            td {
                border: none;
                position: relative;
                padding-left: 50%;
            }

            td:before {
                position: absolute;
                top: 12px;
                left: 15px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #999;
            }

            td:nth-of-type(1):before {
                content: "Acad√©mie";
            }

            td:nth-of-type(2):before {
                content: "Genre";
            }

            td:nth-of-type(3):before {
                content: "Nom";
            }

            td:nth-of-type(4):before {
                content: "Adresse";
            }

            td:nth-of-type(5):before {
                content: "T√©l√©phone";
            }

            td:nth-of-type(6):before {
                content: "Email";
            }

            td:nth-of-type(7):before {
                content: "Mise √† jour";
            }
        }
    </style>
</head>

<body>
    <h1>üéì Recteurs et Rectrices d'Acad√©mie</h1>

    <p id="last-update">Chargement de la date de mise √† jour...</p>

    <table id="rectors-table">
        <thead>
            <tr>
                <th>Acad√©mie</th>
                <th>Genre</th>
                <th>Nom</th>
                <th>Adresse</th>
                <th>T√©l√©phone</th>
                <th>Email</th>
                <th>Mise √† jour</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="5" style="text-align:center; color:#888; padding: 2rem;">Chargement des donn√©es en cours...
                </td>
            </tr>
        </tbody>
    </table>

    <script>
        fetch('recteurs.json')
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#rectors-table tbody');
                const updateText = document.querySelector('#last-update');

                // 1. Gestion de la date de mise √† jour
                if (data.length > 0 && data[0].updated_at) {
                    const rawDate = new Date(data[0].updated_at);
                    const formattedDate = rawDate.toLocaleDateString('fr-FR', {
                        weekday: 'long',
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    // Capitalize la premi√®re lettre du jour
                    const finalDate = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
                    updateText.innerText = `Mise √† jour quotidienne automatique (Derni√®re ex√©cution : ${finalDate})`;
                } else {
                    updateText.innerText = "Mise √† jour quotidienne automatique.";
                }

                // 2. Remplissage du tableau
                tbody.innerHTML = ''; // Vide le loader

                data.forEach(row => {
                    const tr = document.createElement('tr');

                    // NETTOYAGE DU NOM : Supprime tout texte entre parenth√®ses
                    const cleanAcademieName = row.academie.replace(/\s*\(.*?\)/g, '').trim();

                    // FORMATAGE DATE
                    let dateStr = '';
                    if (row.updated_at) {
                        const d = new Date(row.updated_at);
                        dateStr = d.toLocaleDateString('fr-FR');
                    }

                    if (row.error) {
                        tr.innerHTML = `
                            <td><a href="${row.url}" target="_blank">${cleanAcademieName}</a></td>
                            <td colspan="4"><span class="error-text">‚ö†Ô∏è ${row.error} (V√©rifier manuellement)</span></td>
                        `;
                    } else {
                        const dateNomination = row.date_nomination || 'Inconnue';
                        tr.innerHTML = `
                            <td><a href="${row.url}" target="_blank">${cleanAcademieName}</a></td>
                            <td>${row.genre}</td>
                            <td><strong>${row.nom}</strong></td>
                            <td>${row.adresse || '-'}</td>
                            <td>${row.telephone || '-'}</td>
                            <td>${row.email !== '-' ? `<a href="mailto:${row.email}">${row.email}</a>` : '-'}</td>
                            <td style="color: #666; font-size: 0.9em;">${dateStr}</td>
                        `;
                    }
                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                console.error(err);
                document.querySelector('#rectors-table tbody').innerHTML =
                    `<tr><td colspan="5" style="color:#d73a49; text-align:center; padding:2rem;">
                        <strong>Erreur lors du chargement du fichier JSON.</strong><br>
                        V√©rifiez que le fichier recteurs.json a bien √©t√© g√©n√©r√©.
                    </td></tr>`;
            });
    </script>
</body>

</html>
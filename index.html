<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste des Recteurs et Rectrices</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 1280px;
            margin: 2rem auto;
            padding: 0 1rem;
            color: #333;
            line-height: 1.6;
        }

        h1 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
            text-align: center;
        }

        /* Style pour le sous-titre de mise √† jour */
        #last-update {
            color: #666;
            font-style: italic;
            margin-top: 5px;
            margin-bottom: 0;
            font-size: 0.85rem;
            text-align: right;
        }

        table {
            width: fit-content;
            margin: 1rem auto;
            border-collapse: collapse;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            /* Pour les coins arrondis */
        }

        th,
        td {
            border-bottom: 1px solid #eee;
            padding: 8px 10px;
            text-align: left;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #444;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:nth-child(even) {
            background-color: #fafafa;
        }

        tr:hover {
            background-color: #f1f8ff;
        }

        a {
            color: #0366d6;
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
        }

        .error-text {
            color: #d73a49;
            font-size: 0.9em;
            background-color: #ffeef0;
            border-radius: 4px;
            padding: 2px 6px;
        }

        /* Responsive pour mobile */
        @media (max-width: 600px) {

            table,
            thead,
            tbody,
            th,
            td,
            tr {
                display: block;
            }

            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            tr {
                margin-bottom: 1rem;
                border: 1px solid #eee;
                border-radius: 8px;
            }

            td {
                border: none;
                position: relative;
                padding-left: 50%;
            }

            td:before {
                position: absolute;
                top: 12px;
                left: 15px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #999;
            }

            td:nth-of-type(1):before {
                content: "Acad√©mie";
            }

            td:nth-of-type(2):before {
                content: "Genre";
            }

            td:nth-of-type(3):before {
                content: "Nom";
            }

            td:nth-of-type(4):before {
                content: "Adresse";
            }

            td:nth-of-type(5):before {
                content: "T√©l√©phone";
            }

            td:nth-of-type(6):before {
                content: "Email";
            }

            td:nth-of-type(7):before {
                content: "Mise √† jour";
            }
        }
    </style>
</head>

<body>
    <h1>üéì Recteurs et Rectrices d'Acad√©mie</h1>

    <table id="rectors-table">
        <thead>
            <tr>
                <th>Acad√©mie</th>
                <th>Genre</th>
                <th>Nom</th>
                <th>Adresse</th>
                <th>T√©l√©phone</th>
                <th>Email</th>
                <th>Mise √† jour</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="5" style="text-align:center; color:#888; padding: 2rem;">Chargement des donn√©es en cours...
                </td>
            </tr>
        </tbody>
    </table>

    <p id="last-update">Chargement de la date de mise √† jour...</p>

    <script>
        fetch('recteurs.json')
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#rectors-table tbody');
                const updateText = document.querySelector('#last-update');

                // 1. Gestion de la date de mise √† jour
                if (data.length > 0 && data[0].updated_at) {
                    const rawDate = new Date(data[0].updated_at);
                    const formattedDate = rawDate.toLocaleDateString('fr-FR', {
                        weekday: 'long',
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    // Capitalize la premi√®re lettre du jour
                    const finalDate = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
                    updateText.innerText = `Mise √† jour quotidienne automatique (Derni√®re ex√©cution : ${finalDate})`;
                } else {
                    updateText.innerText = "Mise √† jour quotidienne automatique.";
                }

                // Mapping des emails (hardcoded)
                const emailMapping = {
                    "Aix-Marseille": "ce.rectorat@ac-aix-marseille.fr",
                    "Amiens": "ce.rectorat@ac-amiens.fr",
                    "Besan√ßon": "ce.rectorat@ac-besancon.fr",
                    "Bordeaux": "ce.rectorat@ac-bordeaux.fr",
                    "Clermont-Ferrand": "ce.rectorat@ac-clermont.fr",
                    "Corse": "ce.rectorat@ac-corse.fr",
                    "Cr√©teil": "ce.rectorat@ac-creteil.fr",
                    "Dijon": "ce.rectorat@ac-dijon.fr",
                    "Grenoble": "ce.rectorat@ac-grenoble.fr",
                    "Guadeloupe": "ce.rectorat@ac-guadeloupe.fr",
                    "Guyane": "ce.rectorat@ac-guyane.fr",
                    "La R√©union": "ce.rectorat@ac-reunion.fr",
                    "Lille": "ce.rectorat@ac-lille.fr",
                    "Limoges": "ce.rectorat@ac-limoges.fr",
                    "Lyon": "ce.rectorat@ac-lyon.fr",
                    "Martinique": "ce.rectorat@ac-martinique.fr",
                    "Mayotte": "ce.rectorat@ac-mayotte.fr",
                    "Montpellier": "ce.rectorat@ac-montpellier.fr",
                    "Nancy-Metz": "ce.rectorat@ac-nancy-metz.fr",
                    "Nantes": "ce.rectorat@ac-nantes.fr",
                    "Nice": "ce.rectorat@ac-nice.fr",
                    "Normandie": "ce.rectorat@ac-normandie.fr",
                    "Nouvelle-Cal√©donie": "ce.rectorat@ac-noumea.nc",
                    "Orl√©ans-Tours": "ce.rectorat@ac-orleans-tours.fr",
                    "Paris": "ce.rectorat@ac-paris.fr",
                    "Poitiers": "ce.rectorat@ac-poitiers.fr",
                    "Polyn√©sie fran√ßaise": "accueil@ac-polynesie.pf",
                    "Reims": "ce.rectorat@ac-reims.fr",
                    "Rennes": "ce.rectorat@ac-rennes.fr",
                    "Saint-Pierre-et-Miquelon": "ia@ac-spm.fr",
                    "Strasbourg": "ce.rectorat@ac-strasbourg.fr",
                    "Toulouse": "ce.rectorat@ac-toulouse.fr",
                    "Versailles": "ce.rectorat@ac-versailles.fr",
                    "Wallis-et-Futuna": "ce.rectorat@ac-wf.wf"
                };

                // 2. Remplissage du tableau
                tbody.innerHTML = ''; // Vide le loader

                data.forEach(row => {
                    const tr = document.createElement('tr');

                    // NETTOYAGE DU NOM : Supprime tout texte entre parenth√®ses
                    const cleanAcademieName = row.academie.replace(/\s*\(.*?\)/g, '').trim();

                    // FORMATAGE DATE
                    let dateStr = '';
                    if (row.updated_at) {
                        const d = new Date(row.updated_at);
                        dateStr = d.toLocaleDateString('fr-FR');
                    }

                    if (row.error) {
                        tr.innerHTML = `
                            <td><a href="${row.url}" target="_blank">${cleanAcademieName}</a></td>
                            <td colspan="4"><span class="error-text">‚ö†Ô∏è ${row.error} (V√©rifier manuellement)</span></td>
                        `;
                    } else {
                        const dateNomination = row.date_nomination || 'Inconnue';
                        // On r√©cup√®re l'email hardcod√© pour cette acad√©mie (en utilisant le nom clean√©)
                        // On essaye d'abord row.academie (nom original du JSON) car le mapping utilise les cl√©s exactes
                        // Si le JSON contient "Aix-Marseille", notre cl√© est "Aix-Marseille". 
                        // cleanAcademieName retire juste les parenth√®ses s'il y en a.
                        // Par s√©curit√© on peut utiliser row.academie qui correspond aux cl√©s du mapping.
                        const email = emailMapping[row.academie] || '-';

                        tr.innerHTML = `
                            <td><a href="${row.url}" target="_blank">${cleanAcademieName}</a></td>
                            <td>${row.genre}</td>
                            <td><strong>${row.nom}</strong></td>
                            <td>${row.adresse || '-'}</td>
                            <td>${row.telephone && row.telephone !== '-' ? `<a href="tel:${row.telephone.replace(/\s/g, '')}" title="${row.telephone}">üìû</a>` : '-'}</td>
                            <td>${email !== '-' ? `<a href="mailto:${email}" title="${email}">‚úâÔ∏è</a>` : '-'}</td>
                            <td style="color: #666; font-size: 0.9em;">${dateStr}</td>
                        `;
                    }
                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                console.error(err);
                document.querySelector('#rectors-table tbody').innerHTML =
                    `<tr><td colspan="5" style="color:#d73a49; text-align:center; padding:2rem;">
                        <strong>Erreur lors du chargement du fichier JSON.</strong><br>
                        V√©rifiez que le fichier recteurs.json a bien √©t√© g√©n√©r√©.
                    </td></tr>`;
            });
    </script>
</body>

</html>